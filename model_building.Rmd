---
title: "Monash Adversity and Mental Health ABCD project"
author: "Michelle Byrne & Chrysa Tsiapas & Divyangana Rakesh & George Youssef"
date: "7/20/2021"
output: html_document
---

## Set Working Directory
```{r Set Directory, message=FALSE, warning=FALSE, include=FALSE}
getwd()

#You should set this to wherever you keep the data for this project 
workdir='C:/Users/michelle/Google Drive/Professional/Students/0_Monash Students/Chrysa Tsiapas/' 
```

## Loading Libraries

```{r libraries, include = F}
library(tidyverse)
library(lavaan)
library(semPlot)
library(reshape2)
library(dplyr)
library(Hmisc)
library(corrplot)
library(lmtest)
library(nlsem)
library(psych)
library(GPArotation)
```

## Load model building datasets (3)
```{r load model building subsamples}
MB_subsample1 <- read_csv(file.path(workdir,"MB_subsample1.csv"))
MB_subsample2 <- read_csv(file.path(workdir,"MB_subsample2.csv"))
MB_subsample3 <- read_csv(file.path(workdir,"MB_subsample3.csv"))
str(MB_subsample1) # might need to change the binary vars to factors? Check what lavaan needs
```

## Simple correlation matrix of all indices (by subsample)
```{r correlations}
sub1_num <- (select(MB_subsample1, 4:86))
subsample1_corr <- rcorr(as.matrix(sub1_num))
S1_cor_plot <- corrplot(subsample1_corr$r, method = "number", type = "upper", order = "original", tl.col = "black", tl.srt = 45, tl.cex = .7, number.cex = .7, diag = FALSE)
subsample1_corr$r
subsample1_corr$P

write.csv(subsample1_corr$r, file = "MB_subsample1_rs.csv")
write.csv(subsample1_corr$P, file = "MB_subsample1_ps.csv")

# Note - eventually need to insert Chrysa's cross tabs / chi-squared code here for the binary variables

# 2-Way Cross Tabulation - Life EVents Scale (parent/youth) - MB_subsample1_new
library(gmodels)

CrossTable(MB_subsample1_new$ple_died_p_bad, MB_subsample1_new$ple_died_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_injured_p_bad, MB_subsample1_new$ple_injured_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)           

CrossTable(MB_subsample1_new$ple_crime_p_bad, MB_subsample1_new$ple_crime_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_friend_p_bad, MB_subsample1_new$ple_friend_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_friend_injur_p_bad, MB_subsample1_new$ple_friend_injur_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_financial_p_bad, MB_subsample1_new$ple_financial_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_sud_p_bad, MB_subsample1_new$ple_sud_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_ill_p_bad, MB_subsample1_new$ple_ill_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_injur_p_bad, MB_subsample1_new$ple_injur_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_argue_p_bad, MB_subsample1_new$ple_argue_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_job_p_bad, MB_subsample1_new$ple_job_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_away_p_bad, MB_subsample1_new$ple_away_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_arrest_p_bad, MB_subsample1_new$ple_arrest_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_friend_died_p_bad, MB_subsample1_new$ple_friend_died_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_mh_p_bad, MB_subsample1_new$ple_mh_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_sib_p_bad, MB_subsample1_new$ple_sib_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_victim_p_bad, MB_subsample1_new$ple_victim_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_separ_p_bad, MB_subsample1_new$ple_separ_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_law_p_bad, MB_subsample1_new$ple_law_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_school_p_bad, MB_subsample1_new$ple_school_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_move_p_bad, MB_subsample1_new$ple_move_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_jail_p_bad, MB_subsample1_new$ple_jail_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_step_p_bad, MB_subsample1_new$ple_step_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_new_job_p_bad, MB_subsample1_new$ple_new_job_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_new_sib_p_bad, MB_subsample1_new$ple_new_sib_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

## 2-Way Cross Tabulation - arrest/jail/law/trouble holding job,fights,police items - MB_subsample1_new

CrossTable(MB_subsample1_new$ple_arrest_y_bad, 
           MB_subsample1_new$ple_law_y_bad,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_arrest_y_bad, 
           MB_subsample1_new$ple_jail_y_bad,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_arrest_y_bad, 
           MB_subsample1_new$famhx_ss_parent_trb_p_rec,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_law_y_bad, 
           MB_subsample1_new$ple_jail_y_bad,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_law_y_bad, 
           MB_subsample1_new$famhx_ss_parent_trb_p_rec,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_jail_y_bad, 
           MB_subsample1_new$famhx_ss_parent_trb_p_rec,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)


## 2-Way Cross Tabulation - parent mental illness & substance abuse items (Family History) - MB_subsample1_new

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_dg_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_dprs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_ma_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_dprs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_ma_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_ma_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_nrv_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_nrv_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_nrv_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_prf_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_prf_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_hspd_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)


# LIST OF ALL VARIABLES HERE. NOTE THAT THE MODELS BELOW ALREADY ~~REMOVED ALL PARENT REPORT LIFE EVENTS~~, BUT THEY ARE LISTED HERE:
#
# demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + 	famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_p_bad + ple_injured_p_bad + ple_crime_p_bad + 	ple_friend_p_bad + ple_friend_injur_p_bad + ple_financial_p_bad + ple_sud_p_bad + 	ple_ill_p_bad + ple_injur_p_bad + ple_argue_p_bad + ple_job_p_bad + ple_away_p_bad + 	ple_arrest_p_bad + ple_friend_died_p_bad + ple_mh_p_bad + ple_sib_p_bad + ple_victim_p_bad + ple_separ_p_bad + ple_law_p_bad + ple_school_p_bad + ple_move_p_bad + ple_jail_p_bad + 	ple_step_p_bad + ple_new_job_p_bad + ple_new_sib_p_bad + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + 	fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z

#george I'm sorry for my messy code and overcommenting. Pls don't judge me. MLB
```



```{r efa lavaan adversity factor}
# First we set up an EFA to see really how many factors there should be. We hope that one day we can fit all indicators onto one predefined adversity var in a CFA (later in code). But first we need to do these EFAs.
# See: https://vankesteren.github.io/efast/efa_lavaan 
# And: https://stats.stackexchange.com/questions/190190/can-lavaan-sem-cfa-be-used-to-do-factor-analysis-like-factanal-efa
# And: https://solomonkurz.netlify.app/post/2021-05-11-yes-you-can-fit-an-exploratory-factor-analysis-with-lavaan/
# OR possibly with the psych package first, just to do plain factor analysis (so don't constrain/pre-decide the number of factors?)

# UPDATE: None of the lavaan EFAs below work with WLSMV because of something to do with missing values. They work with MLR and non-ordered but are not identified.

# Here first is set up for EFA with just one factor
f1 <- '
efa("efa")*f1 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f1 <- 
  cfa(model = f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )
# NaNs producedError in eigen(A, symmetric = TRUE, only.values = TRUE) : 
#  infinite or missing values in 'x'
# 
# whyyyyyy

summary(efa_f1, fit.measures = TRUE)

# Repeat with 2 factor, 3 factor, 4 factor etc EFA models - look for NS chi-squared values and identify which model it is (and what are the obvious factors?)

f2 <- '
efa("efa")*f1 +
efa("efa")*f2 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f2 <- 
  cfa(model = f2,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      mimic = "Mplus",
      )
summary(efa_f2, fit.measures = TRUE)

f3 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f3 <- 
  cfa(model = f3,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f4 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f4 <- 
  cfa(model = f4,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f5 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f5 <- 
  cfa(model = f5,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f6 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f6 <- 
  cfa(model = f6,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f7 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f7 <- 
  cfa(model = f7,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f8 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 +
efa("efa")*f8 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f8 <- 
  cfa(model = f8,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f9 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 +
efa("efa")*f8 +
efa("efa")*f9 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f9 <- 
  cfa(model = f9,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f10 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 +
efa("efa")*f8 +
efa("efa")*f9 +
efa("efa")*f10 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f10 <- 
  cfa(model = f10,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )


```   


```{r psych fa}
#missing	
#if scores are TRUE, and missing=TRUE, then impute missing values using either the median or the mean. Haven't done this yet but could.

MB_S1_trim <- select(MB_subsample1, -c("X1","src_subject_id","eventname","subsample","ple_died_p_bad","ple_injured_p_bad","ple_crime_p_bad",
                                       "ple_friend_p_bad","ple_friend_injur_p_bad","ple_financial_p_bad","ple_sud_p_bad","ple_ill_p_bad",
                                       "ple_injur_p_bad","ple_argue_p_bad","ple_job_p_bad","ple_away_p_bad","ple_arrest_p_bad",
                                       "ple_friend_died_p_bad","ple_mh_p_bad","ple_sib_p_bad","ple_victim_p_bad","ple_separ_p_bad",
                                       "ple_law_p_bad","ple_school_p_bad","ple_move_p_bad","ple_jail_p_bad","ple_step_p_bad",
                                       "ple_new_job_p_bad","ple_new_sib_p_bad")) 

fa_1 <- fa(MB_S1_trim, nfactors=1, rotate = "oblimin")
fa_1

fa_2 <- fa(MB_S1_trim, nfactors=2, rotate = "oblimin")
fa_2

fa_3 <- fa(MB_S1_trim, nfactors=3, rotate = "oblimin")
fa_3

fa_4 <- fa(MB_S1_trim, nfactors=4, rotate = "oblimin")
fa_4

fa_5 <- fa(MB_S1_trim, nfactors=5, rotate = "oblimin")
fa_5

fa_6 <- fa(MB_S1_trim, nfactors=6, rotate = "oblimin")
fa_6

fa_7 <- fa(MB_S1_trim, nfactors=7, rotate = "oblimin")
fa_7

fa_8 <- fa(MB_S1_trim, nfactors=8, rotate = "oblimin")
fa_8

fa_9 <- fa(MB_S1_trim, nfactors=9, rotate = "oblimin")
fa_9

fa_10 <- fa(MB_S1_trim, nfactors=10, rotate = "oblimin")
fa_10

fa_20 <- fa(MB_S1_trim, nfactors=20, rotate = "oblimin")
fa_20
write.csv(fa_20$loadings, file = "loadings_fa20_no_parentSLEs.csv")
```

## Potential new model building datasets after combining the demo items based on FA to make binary econ harship and a binary medical econ hardship variables
```{r econ hardship reduced variables}
MB_subsample1_new <- read_csv(file.path(workdir,"MB_subsample1_new.csv"))
MB_subsample2_new <- read_csv(file.path(workdir,"MB_subsample2_new.csv"))
MB_subsample3_new <- read_csv(file.path(workdir,"MB_subsample3_new.csv"))
str(MB_subsample1) # might need to change the binary vars to factors? Check what lavaan needs

# "econ_hardship" is a variable that could replace "demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec" and
# "med_econ_hardship" is a variable that could replace "demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec", but first check from previous EFA if these load together and could be reduced. (If so, datasets above are ready to go with these additional two variables) 

#Update, if you look at loadings in "loadings_fa20_no_parentSLEs.xls", these items still load together. Went ahead and checked psych FA with those reduced:

MB_S1_trim_2 <- select(MB_subsample1_new, -c("X1","src_subject_id","eventname","subsample","ple_died_p_bad","ple_injured_p_bad","ple_crime_p_bad",
                                       "ple_friend_p_bad","ple_friend_injur_p_bad","ple_financial_p_bad","ple_sud_p_bad","ple_ill_p_bad",
                                       "ple_injur_p_bad","ple_argue_p_bad","ple_job_p_bad","ple_away_p_bad","ple_arrest_p_bad",
                                       "ple_friend_died_p_bad","ple_mh_p_bad","ple_sib_p_bad","ple_victim_p_bad","ple_separ_p_bad",
                                       "ple_law_p_bad","ple_school_p_bad","ple_move_p_bad","ple_jail_p_bad","ple_step_p_bad",
                                       "ple_new_job_p_bad","ple_new_sib_p_bad","demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec",
                                       "demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec",
                                       "demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec"))
fa_20_reduced <- fa(MB_S1_trim_2, nfactors=20, rotate = "oblimin")
fa_20_reduced
# convergence not obtained in GPFoblq. 1000 iterations used.

fa_10_reduced <- fa(MB_S1_trim_2, nfactors=10, rotate = "oblimin")
fa_10_reduced
write.csv(fa_10_reduced$loadings, file = "loadings_fa10_reduced.csv")
```

## 1 factor model with subsample 1 - CFA lavvan
            

```{r cfa}
# Define model 1 - all indicators under one single adversity factor, no covariances. Do things load on nicely to one predefined factor?
# First with WLSMV, missing pairwise:
model1_nocov <- "
#All adversity vars Model 1

adversity =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + 	famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + 	fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
"

fit_model1_nocov <- cfa(model = model1_nocov, 
                  data = MB_subsample1,
                  estimator = "WLSMV",
                  missing = "pairwise",
                  mimic = "Mplus",
                  ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
                  )
summary(fit_model1_nocov)

# estimator = MLR, missing = FIML, mimic = Mplus
fit_model1_nocov_MLR <- cfa(model = model1_nocov,
                  data = MB_subsample1,
                  missing = "FIML",
                  estimator = "MLR",
                  mimic = "Mplus"
                  )
summary(fit_model1_nocov_MLR)

# estimator = "PML", missing = "available.cases" below (and verbose = T , maybe to get standardized output)
# NOTE THIS MODEL BELOW FAILED WITH MESSAGE: 
# NaNs producedError in pbivnorm::pbivnorm(x = upper.x, y = upper.y, rho = rho) : 
#  'rho' must be a valid correlation (-1 <= rho <= 1)
fit_model1_nocov_PML <- cfa(model = model1_nocov, 
                  data = MB_subsample1,
                  estimator = "PML",
                  missing = "available.cases",
                  verbose = T,
                  ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
                  )
summary(fit_model1_nocov_PML)



# Define model 1 - all indicators under one single adversity factor, WITH covariances. If nocov model didn't work, does adding measurement tool covariances fix it?
model1_cov <- "
#All adversity vars Model 1

adversity =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + 	famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + 	fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z

#Covariances for questionnaires/measures
ksads_ptsd_raw_761_p ~~ ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p + ksads_ptsd_raw_766_p
ksads_ptsd_raw_763_p ~~ ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p +  ksads_ptsd_raw_766_p
ksads_ptsd_raw_767_p ~~ ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + ksads_ptsd_raw_766_p
ksads_ptsd_raw_768_p ~~ ksads_ptsd_raw_769_p + ksads_ptsd_raw_766_p
ksads_ptsd_raw_769_p ~~ ksads_ptsd_raw_766_p


famhx_ss_parent_alc_p_rec ~~ famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec

famhx_ss_parent_dg_p_rec ~~ famhx_ss_parent_dprs_p_rec + famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec

famhx_ss_parent_dprs_p_rec ~~ famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec

famhx_ss_parent_ma_p_rec ~~ famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec

famhx_ss_parent_vs_p_rec ~~ famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec

famhx_ss_parent_trb_p_rec ~~ famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec
famhx_ss_parent_nrv_p_rec ~~ famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec
famhx_ss_parent_prf_p_rec ~~ famhx_ss_parent_hspd_p_rec + famhx_ss_parent_scd_p_rec
famhx_ss_parent_hspd_p_rec ~~ famhx_ss_parent_scd_p_rec


fes_p_ss_fc_z ~~ fes_y_ss_fc_z


crpbi_y_ss_parent_rev_z ~~ crpbi_y_ss_caregiver_rev_z


ple_died_y_bad ~~ ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_injured_y_bad ~~ ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_crime_y_bad ~~ ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_friend_y_bad ~~ ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_friend_injur_y_bad ~~ ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_financial_y_bad ~~ ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_sud_y_bad ~~ ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_ill_y_bad ~~ ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_injur_y_bad ~~ ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_argue_y_bad ~~ ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_job_y_bad ~~ ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_away_y_bad ~~ ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_arrest_y_bad ~~ ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_friend_died_y_bad ~~ ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_mh_y_bad ~~ ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_sib_y_bad ~~ ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_victim_y_bad ~~ ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad

ple_separ_y_bad ~~ ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
ple_law_y_bad ~~ ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
ple_school_y_bad ~~ ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
ple_move_y_bad ~~ ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
ple_jail_y_bad ~~ ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
ple_step_y_bad ~~ ple_new_job_y_bad + ple_new_sib_y_bad
ple_new_job_y_bad ~~ ple_new_sib_y_bad


demo_fam_exp1_v2_rec ~~ demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec

demo_fam_exp2_v2_rec ~~ demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
demo_fam_exp3_v2_rec ~~ demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
demo_fam_exp4_v2_rec ~~ demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
demo_fam_exp5_v2_rec ~~ demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
demo_fam_exp6_v2_rec ~~ demo_fam_exp7_v2_rec
"

fit_model1_cov <- cfa(model = model1_cov, 
                  data = MB_subsample1,
                  estimator = "WLSMV",
                  missing = "pairwise",
                  ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
                  )
summary(fit_model1_cov)
```


## We can't seem to get all these indicators loaded onto one super (adversity) factor, so in this next part we will try five separate factor analyses, one for each domain of ACES: "Abuse", "Household challenges", "Neglect", "Stressful events", and "Social environment"

```{r efa lavaan domain factors}

# ----- ABUSE -----
# Physical abuse: "ksads_ptsd_raw_761_p", "ksads_ptsd_raw_763_p", 
# Sexual abuse: "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p", "ksads_ptsd_raw_769_p"

abuse_f1 <- '
efa("efa")*abuse_f1 =~ 
ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p 
'
efa_abuse_f1 <- 
  cfa(model = abuse_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )
summary(efa_abuse_f1, fit.measures = TRUE, standardized = TRUE)

efa_abuse_f1_mlr <- 
  cfa(model = abuse_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      mimic = "Mplus",
      )
summary(efa_abuse_f1_mlr, fit.measures = TRUE)
# Both methods for f1 warning
#    The variance-covariance matrix of the estimated parameters (vcov)
#    does not appear to be positive definite! The smallest eigenvalue
#    (= -8.822038e-20) is smaller than zero. This may be a symptom that
#    the model is not identified.

# NS chi-sq 
# option 1. loadings high enough to combine first 4 and keep 5th (769)
# option 2. combine 2 phys abuse, 2 sexual abuse and 1 peer sexual abuse
    


# ----- NEGLECT -----
# Emotional neglect: "crpbi_y_ss_parent_rev_z", "crpbi_y_ss_caregiver_rev_z"
# Physical neglect: "pmq_y_ss_mean_rev_z"

neglect_f1 <- '
efa("efa")*neglect_f1 =~ 
crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z
'
efa_neglect_f1_mlr <- 
  cfa(model = neglect_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      missing = "ML",
      mimic = "Mplus",
      )
summary(efa_neglect_f1_mlr, fit.measures = TRUE, standardized = TRUE)
# 1 factor ran but chi-sq is significant. (bc only 3 indicators)




# ----- STRESSFUL EVENTS -----
# Stressors: '"ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_arrest_y_bad", "ple_friend_died_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_law_y_bad", "ple_school_y_bad", "ple_move_y_bad", "ple_jail_y_bad", "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad"

stress_f1 <- '
efa("efa")*stress_f1 =~ 
ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
'
efa_stress_f1 <- 
  cfa(model = stress_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_arrest_y_bad", "ple_friend_died_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_law_y_bad", "ple_school_y_bad", "ple_move_y_bad", "ple_jail_y_bad", "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad")
      )
summary(efa_stress_f1, fit.measures = TRUE, standardized = TRUE)
# Ran but chi sq NS


stress_f5 <- '
efa("efa")*stress_f1 +
efa("efa")*stress_f2 +
efa("efa")*stress_f3 +
efa("efa")*stress_f4 +
efa("efa")*stress_f5 =~ 
ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
'
efa_stress_f5 <- 
  cfa(model = stress_f5,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_arrest_y_bad", "ple_friend_died_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_law_y_bad", "ple_school_y_bad", "ple_move_y_bad", "ple_jail_y_bad", "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad")
      )
summary(efa_stress_f5, fit.measures = TRUE, standardized = TRUE)

# law items should be combined
# Friend died on its own or removed (since low frequency)
stress_law_f1 <- '
efa("efa")*stress_law_f1 =~
ple_arrest_y_bad + ple_law_y_bad + ple_jail_y_bad
'
efa_stress_law_f1 <-
  cfa(model = stress_law_f1,
      data = MB_subsample1,
      rotation ="oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_arrest_y_bad","ple_law_y_bad","ple_jail_y_bad"))
summary(efa_stress_law_f1, fit.measures = TRUE, standardized = TRUE)

# Remove law + friend died items:
stress_reduced_f3 <- '
efa("efa")*stress_reduced_f1 +
efa("efa")*stress_reduced_f2 +
efa("efa")*stress_reduced_f3 =~ 
ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_school_y_bad + ple_move_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
'
efa_stress_reduced_f3 <- 
  cfa(model = stress_reduced_f3,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_school_y_bad", "ple_move_y_bad",  "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad")
      )
summary(efa_stress_reduced_f3, fit.measures = TRUE, standardized = TRUE)

# Highest loadings, 3 factor stressor model without law or friend dying items:
#   1 - injury -- ple_injur_y_bad (0.603) "Child was seriously injured" - combine with "ple_injured_y_bad", "ple_crime_y_bad","ple_friend_injur_y_bad", "ple_ill_y_bad", "ple_mh_y_bad"
#   2 - changes to home environ (separation) -- ple_separ_y_bad (0.677) "Parents separated or divorced?" - combine with "ple_argue_y_bad", "ple_sib_y_bad", "ple_step_y_bad",
#   3 - moving / new job & school -- ple_move_y_bad (0.726) "Family moved?" - combine with "ple_school_y_bad","ple_new_job_y_bad"

# What should we do about the items that don't have very high loadings on any of these 3 factors?
#   "ple_died_y_bad", "ple_friend_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_victim_y_bad", "ple_new_sib_y_bad"


# ----- SOCIAL ENVIRONMENT -----
# School environment: "srpf_y_ss_ses_rev_Z"
# Neighbourhood: "nsc_p_ss_mean_3_items_rev_Z", "neighborhood_crime_y_rev_Z"

social_f1 <- '
efa("efa")*social_f1 =~ 
srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z
'
efa_social_f1_mlr <- 
  cfa(model = social_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      missing = "ML",
      mimic = "Mplus",
      )
summary(efa_social_f1_mlr, fit.measures = TRUE, standardized = TRUE)
# Ran fine but chi-sq NS (bc only 3 indicators)

# 3 factors model combining Abuse, Neglect, and Social items:
AbNeSo_f3 <- '
efa("efa")*AbNeSo_f1 +
efa("efa")*AbNeSo_f2 +
efa("efa")*AbNeSo_f3 =~ 
ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z
'
efa_AbNeSo_f3 <- 
  cfa(model = AbNeSo_f3,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )
summary(efa_AbNeSo_f3, fit.measures = TRUE, standardized = TRUE)

# New stressor model best items from injury, home env, moving, law + friend died on its own
stress_new_f1 <- '
efa("efa")*new_f1 =~
ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_friend_died_y_bad + ple_law_y_bad
'
efa_stress_new_f1 <- 
  cfa(model = stress_new_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_friend_died_y_bad","ple_law_y_bad")
      )
summary(efa_stress_new_f1, fit.measures = TRUE, standardized = TRUE)
# ple_friend_died_y_bad low - remove (esp if low frequency (NOTE: YES ONLY 42!))

# Re estimate without friend died
stress_new2_f1 <- '
efa("efa")*new2_f1 =~
ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad
'
efa_stress_new2_f1 <- 
  cfa(model = stress_new2_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
summary(efa_stress_new2_f1, fit.measures = TRUE, standardized = TRUE)

# Estimate same model with abuse, neglect, social, new stress (4 factors) AbNeSoSt
AbNeSoSt_f4 <- '
efa("efa")*AbNeSoSt_f1 +
efa("efa")*AbNeSoSt_f2 +
efa("efa")*AbNeSoSt_f3 +
efa("efa")*AbNeSoSt_f4 =~ 
ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad
'
efa_AbNeSoSt_f4 <- 
  cfa(model = AbNeSoSt_f4,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p", "ple_injur_y_bad", "ple_separ_y_bad", "ple_move_y_bad", "ple_law_y_bad")
      )
summary(efa_AbNeSoSt_f4, fit.measures = TRUE, standardized = TRUE)

# Some variances negative, some loadings weirdly placed.
# Tried again but only one item per theoretical domain:

# Physical abuse: ksads_ptsd_raw_763_p 
# Sexual abuse: ksads_ptsd_raw_767_p
# Peer sexual abuse: ksads_ptsd_raw_769_p
# Neglect / lack of acceptance: crpbi_y_ss_parent_rev_z
# Neighborhood safety: neighborhood_crime_y_rev_Z
# Family injured: ple_injur_y_bad
# Family structure change: ple_separ_y_bad
# Moving: ple_move_y_bad
# Family law trouble: ple_law_y_bad

AbNeSoSt_reduced_f1 <- '
efa("efa")*AbNeSoSt_reduced_f1 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad
'
efa_AbNeSoSt_reduced_f1 <- 
  cfa(model = AbNeSoSt_reduced_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_769_p", "crpbi_y_ss_parent_rev_z", "neighborhood_crime_y_rev_Z", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
summary(efa_AbNeSoSt_reduced_f1, fit.measures = TRUE, standardized = TRUE)



# ----- HOUSEHOLD CHALLENGES -----
# Home violence exposure: "ksads_ptsd_raw_766_p"
# Household substance abuse: "famhx_ss_parent_alc_p_rec", "famhx_ss_parent_dg_p_rec""
# Parent Mental illness in household: "famhx_ss_parent_dprs_p_rec", "famhx_ss_parent_ma_p_rec", "famhx_ss_parent_vs_p_rec", "famhx_ss_parent_trb_p_rec", "famhx_ss_parent_nrv_p_rec", "famhx_ss_parent_prf_p_rec", "famhx_ss_parent_hspd_p_rec", "famhx_ss_parent_scd_p_rec", "asr_scr_totprob_t_z"
# Family conflict: "fes_p_ss_fc_z", "fes_y_ss_fc_z"
# Family income: "demo_comb_income_v2_rec_rev_Z"
# Economic hardship: "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec"

MB_subsample1_ren <- rename(MB_subsample1, famhx_alc = famhx_ss_parent_alc_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_dg = famhx_ss_parent_dg_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_dprs = famhx_ss_parent_dprs_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_ma = famhx_ss_parent_ma_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_vs = famhx_ss_parent_vs_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_trb = famhx_ss_parent_trb_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_nrv = famhx_ss_parent_nrv_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_prf = famhx_ss_parent_prf_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_hspd = famhx_ss_parent_hspd_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_scd = famhx_ss_parent_scd_p_rec)

household_f1 <- '
efa("efa")*household_f1 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_household_f1 <- 
  cfa(model = household_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd", "demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_household_f1, fit.measures = TRUE, standardized = TRUE)
# Chi sq is sig but loadings are all pretty decent.

household_f5 <- '
efa("efa")*household_f1 +
efa("efa")*household_f2 + 
efa("efa")*household_f3 +
efa("efa")*household_f4 +
efa("efa")*household_f5 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_household_f5 <- 
  cfa(model = household_f5,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd", "demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_household_f5, fit.measures = TRUE, standardized = TRUE)
# 5 factor runs ok but chi-sq is sig. Try 6 factor.

household_f6 <- '
efa("efa")*household_f1 +
efa("efa")*household_f2 + 
efa("efa")*household_f3 +
efa("efa")*household_f4 +
efa("efa")*household_f5 +
efa("efa")*household_f6 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_household_f6 <- 
  cfa(model = household_f6,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd", "demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_household_f6, fit.measures = TRUE, standardized = TRUE)
# 6 factor some variance are neg but chi-sq is NS

# Trying economic hardship ones on their own:
economic_f1 <- '
efa("efa")*economic_f1 =~
demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_economic_f1 <-
  cfa(model = economic_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_economic_f1, fit.measures = TRUE, standardized = TRUE)
# Chi sq significant but loadings all high. 
# Try 2 factor in case medical econ hardship is separate:
economic_f2 <- '
efa("efa")*economic_f1 +
efa("efa")*economic_f2 =~
demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_economic_f2 <-
  cfa(model = economic_f2,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_economic_f2, fit.measures = TRUE, standardized = TRUE)
# Could not compute standard errors! The information matrix could
#    not be inverted. This may be a symptom that the model is not
#   identified.
# Item 7 seems to be causing problems
# Anyway, highest economic hardship loading on the 1 factor (sig chi sq) is xp2, telephone cut off (0.884) but all in in .7 - .8

# Now trying other household challenge items without economic hardship...
household_reduced_f1 <- '
efa("efa")*household_reduced_f1 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z 
'
efa_household_reduced_f1 <- 
  cfa(model = household_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd")
      )
summary(efa_household_reduced_f1, fit.measures = TRUE, standardized = TRUE)
# chi-sq sig

household_reduced_f4 <- '
efa("efa")*household_reduced_f1 +
efa("efa")*household_reduced_f2 +
efa("efa")*household_reduced_f3 +
efa("efa")*household_reduced_f4 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z 
'
efa_household_reduced_f4 <- 
  cfa(model = household_reduced_f4,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd")
      )
summary(efa_household_reduced_f4, fit.measures = TRUE, standardized = TRUE)
# chi sq-NS

# Highest loadings, 4 factor household model without econ hardhip items:
#   1 --- dprs (0.847) "" - combine with "ptsd766", "alc","ma","vs","trb"
#   2 --- prf (0.937) "" - combine with "dg","nrv","hspd","scd",
#   3 --- "asr" (0.714) "" - combine with "fes_p"
#   4 --- "fes_y" (.665) on its own

#Try those 4 alone:
household_new_reduced_f1 <- '
efa("efa")*household_new_reduced_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z + fes_y_ss_fc_z  
'
efa_household_new_reduced_f1 <- 
  cfa(model = household_new_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf")
      )
summary(efa_household_new_reduced_f1, fit.measures = TRUE, standardized = TRUE)
# chi-sq sig

# Try those 4 PLUS the telephone one from econ hardship:
household_new_f1 <- '
efa("efa")*household_new_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_fam_exp2_v2_rec 
'
efa_household_new_f1 <- 
  cfa(model = household_new_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf", "demo_fam_exp2_v2_rec")
      )
summary(efa_household_new_f1, fit.measures = TRUE, standardized = TRUE)
#chi-sq sig

#fes_y is causing problems. Try it removed
household_new2_f1 <- '
efa("efa")*household_new2_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z + demo_fam_exp2_v2_rec 
'
efa_household_new2_f1 <- 
  cfa(model = household_new2_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf", "demo_fam_exp2_v2_rec")
      )
summary(efa_household_new2_f1, fit.measures = TRUE, standardized = TRUE)
# chi-sq still sig. Remove econ hardship again
household_new2_reduced_f1 <- '
efa("efa")*household_new2_reduced_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z  
'
efa_household_new2_reduced_f1 <- 
  cfa(model = household_new2_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf")
      )
summary(efa_household_new2_reduced_f1, fit.measures = TRUE, standardized = TRUE)
#chi sq still sig but ok bc only 3 items
# highest loading famhx_prf (0.748)

# ----Try a full model

# Physical abuse: ksads_ptsd_raw_763_p 
# Sexual abuse: ksads_ptsd_raw_767_p
# Peer sexual abuse: ksads_ptsd_raw_769_p
# Neglect / lack of acceptance: crpbi_y_ss_parent_rev_z
# Neighborhood safety: neighborhood_crime_y_rev_Z
# Family injured: ple_injur_y_bad
# Family structure change: ple_separ_y_bad
# Moving: ple_move_y_bad
# Family law trouble: ple_law_y_bad
# Economic hardship: demo_fam_exp2_v2_rec
# Household challenges (parent mental health): famhx_prf

AbNeSoStHo_reduced_f1 <- '
efa("efa")*AbNeSoStHo_reduced_f1 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad + demo_fam_exp2_v2_rec + famhx_prf
'
efa_AbNeSoStHo_reduced_f1 <- 
  cfa(model = AbNeSoStHo_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_769_p", "crpbi_y_ss_parent_rev_z", "neighborhood_crime_y_rev_Z", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad", "demo_fam_exp2_v2_rec", "famhx_prf")
      )
summary(efa_AbNeSoStHo_reduced_f1, fit.measures = TRUE, standardized = TRUE)
```

## also do FA with psych package separately by domain:
```{r efa psych FA domain factors}
abuse_trim <- select(MB_subsample1, c("ksads_ptsd_raw_761_p", "ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p", "ksads_ptsd_raw_769_p")) 
abuse_fa_1 <- fa(abuse_trim, nfactors=1, rotate = "oblimin")
abuse_fa_1
abuse_fa_2 <- fa(abuse_trim, nfactors=2, rotate = "oblimin")
abuse_fa_2
write.csv(abuse_fa_1$loadings, file = file.path(workdir,"/ABCD adversity paper analysis results/Model Building Subsample 1/domains/abuse_fa_1.csv"))
write.csv(abuse_fa_2$loadings, file = file.path(workdir,"/ABCD adversity paper analysis results/Model Building Subsample 1/domains/abuse_fa_2.csv"))

household_trim <- select(MB_subsample1, c("ksads_ptsd_raw_766_p", "famhx_ss_parent_alc_p_rec", "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec", "famhx_ss_parent_ma_p_rec", "famhx_ss_parent_vs_p_rec", "famhx_ss_parent_trb_p_rec", "famhx_ss_parent_nrv_p_rec", "famhx_ss_parent_prf_p_rec", "famhx_ss_parent_hspd_p_rec", "famhx_ss_parent_scd_p_rec", "asr_scr_totprob_t_z","fes_p_ss_fc_z", "fes_y_ss_fc_z","demo_comb_income_v2_rec_rev_Z","demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")) 
household_fa_1 <- fa(household_trim, nfactors=1, rotate = "oblimin")
household_fa_1
household_fa_2 <- fa(household_trim, nfactors=2, rotate = "oblimin")
household_fa_2
household_fa_3 <- fa(household_trim, nfactors=3, rotate = "oblimin")
household_fa_3
household_fa_4 <- fa(household_trim, nfactors=4, rotate = "oblimin")
household_fa_4
household_fa_5 <- fa(household_trim, nfactors=5, rotate = "oblimin")
household_fa_5
household_fa_6 <- fa(household_trim, nfactors=6, rotate = "oblimin")
household_fa_6
household_fa_7 <- fa(household_trim, nfactors=7, rotate = "oblimin")
household_fa_7
household_fa_8 <- fa(household_trim, nfactors=8, rotate = "oblimin")
household_fa_8
household_fa_9 <- fa(household_trim, nfactors=9, rotate = "oblimin")
household_fa_9
household_fa_10 <- fa(household_trim, nfactors=10, rotate = "oblimin")
household_fa_10
write.csv(household_fa_8$loadings, file = file.path(workdir,"/ABCD adversity paper analysis results/Model Building Subsample 1/domains/household_fa_8.csv"))

neglect_trim <- select(MB_subsample1, c("crpbi_y_ss_parent_rev_z", "crpbi_y_ss_caregiver_rev_z", "pmq_y_ss_mean_rev_z")) 
neglect_fa_1 <- fa(neglect_trim, nfactors=1, rotate = "oblimin")
neglect_fa_1 # Note this is not identified, but loadings on all three are high.
write.csv(neglect_fa_1$loadings, file = file.path(workdir,"/ABCD adversity paper analysis results/Model Building Subsample 1/domains/neglect_fa_1.csv"))

stress_trim <- select(MB_subsample1, c("ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_arrest_y_bad", "ple_friend_died_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_law_y_bad", "ple_school_y_bad", "ple_move_y_bad", "ple_jail_y_bad", "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad")) 
stress_fa_1 <- fa(stress_trim, nfactors=1, rotate = "oblimin")
stress_fa_1
stress_fa_2 <- fa(stress_trim, nfactors=2, rotate = "oblimin")
stress_fa_2
stress_fa_3 <- fa(stress_trim, nfactors=3, rotate = "oblimin")
stress_fa_3
stress_fa_4 <- fa(stress_trim, nfactors=4, rotate = "oblimin")
stress_fa_4
stress_fa_5 <- fa(stress_trim, nfactors=5, rotate = "oblimin")
stress_fa_5
stress_fa_6 <- fa(stress_trim, nfactors=6, rotate = "oblimin")
stress_fa_6
stress_fa_7 <- fa(stress_trim, nfactors=7, rotate = "oblimin")
stress_fa_7
stress_fa_8 <- fa(stress_trim, nfactors=8, rotate = "oblimin")
stress_fa_8
stress_fa_9 <- fa(stress_trim, nfactors=9, rotate = "oblimin")
stress_fa_9
stress_fa_10 <- fa(stress_trim, nfactors=10, rotate = "oblimin")
stress_fa_10
stress_fa_11 <- fa(stress_trim, nfactors=11, rotate = "oblimin")
stress_fa_11
write.csv(stress_fa_11$loadings, file = file.path(workdir,"/ABCD adversity paper analysis results/Model Building Subsample 1/domains/stress_fa_11.csv"))

social_trim <- select(MB_subsample1, c("srpf_y_ss_ses_rev_Z", "nsc_p_ss_mean_3_items_rev_Z", "neighborhood_crime_y_rev_Z")) 
social_fa_1 <- fa(social_trim, nfactors=1, rotate = "oblimin")
social_fa_1 # Note this is not identified, but loadings on all three are high.
write.csv(social_fa_1$loadings, file = file.path(workdir,"/ABCD adversity paper analysis results/Model Building Subsample 1/domains/social_fa_1.csv"))
```


---
title: "Monash Adversity and Mental Health ABCD project"
author: "Michelle Byrne & Chrysa Tsiapas & Divyangana Rakesh & George Youssef"
date: "7/20/2021"
output: html_document
---

## Set Working Directory
```{r Set Directory, message=FALSE, warning=FALSE, include=FALSE}
getwd()

#You should set this to wherever you keep the data for this project 
workdir='C:/Users/michelle/Google Drive/Professional/Students/0_Monash Students/Chrysa Tsiapas/Paper/Datasets' 
```

## Loading Libraries

```{r libraries, include = F}
library(tidyverse)
library(lavaan)
library(semPlot)
library(reshape2)
library(dplyr)
library(Hmisc)
library(corrplot)
library(lmtest)
library(nlsem)
library(psych)
library(GPArotation)
```

## Load model building datasets (3)
```{r load model building subsamples}
MB_subsample1 <- read_csv(file.path(workdir,"MB_subsample1.csv"))
MB_subsample2 <- read_csv(file.path(workdir,"MB_subsample2.csv"))
MB_subsample3 <- read_csv(file.path(workdir,"MB_subsample3.csv"))
# str(MB_subsample1) # might need to change the binary vars to factors? Check what lavaan needs
```
## --------------------------------------------
## ------------- SUBSAMPLE #1 EFAs ------------
## --------------------------------------------


## Simple correlation matrix of all indices (by subsample)
```{r correlations}
sub1_num <- (select(MB_subsample1, 4:86))
subsample1_corr <- rcorr(as.matrix(sub1_num))
S1_cor_plot <- corrplot(subsample1_corr$r, method = "number", type = "upper", order = "original", tl.col = "black", tl.srt = 45, tl.cex = .7, number.cex = .7, diag = FALSE)
subsample1_corr$r
subsample1_corr$P

write.csv(subsample1_corr$r, file = "MB_subsample1_rs.csv")
write.csv(subsample1_corr$P, file = "MB_subsample1_ps.csv")

# Note - eventually need to insert Chrysa's cross tabs / chi-squared code here for the binary variables

# 2-Way Cross Tabulation - Life EVents Scale (parent/youth) - MB_subsample1_new
library(gmodels)

CrossTable(MB_subsample1_new$ple_died_p_bad, MB_subsample1_new$ple_died_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_injured_p_bad, MB_subsample1_new$ple_injured_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)           

CrossTable(MB_subsample1_new$ple_crime_p_bad, MB_subsample1_new$ple_crime_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_friend_p_bad, MB_subsample1_new$ple_friend_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_friend_injur_p_bad, MB_subsample1_new$ple_friend_injur_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_financial_p_bad, MB_subsample1_new$ple_financial_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_sud_p_bad, MB_subsample1_new$ple_sud_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_ill_p_bad, MB_subsample1_new$ple_ill_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_injur_p_bad, MB_subsample1_new$ple_injur_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_argue_p_bad, MB_subsample1_new$ple_argue_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_job_p_bad, MB_subsample1_new$ple_job_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_away_p_bad, MB_subsample1_new$ple_away_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_arrest_p_bad, MB_subsample1_new$ple_arrest_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_friend_died_p_bad, MB_subsample1_new$ple_friend_died_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_mh_p_bad, MB_subsample1_new$ple_mh_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_sib_p_bad, MB_subsample1_new$ple_sib_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_victim_p_bad, MB_subsample1_new$ple_victim_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_separ_p_bad, MB_subsample1_new$ple_separ_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_law_p_bad, MB_subsample1_new$ple_law_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_school_p_bad, MB_subsample1_new$ple_school_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_move_p_bad, MB_subsample1_new$ple_move_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_jail_p_bad, MB_subsample1_new$ple_jail_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_step_p_bad, MB_subsample1_new$ple_step_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_new_job_p_bad, MB_subsample1_new$ple_new_job_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_new_sib_p_bad, MB_subsample1_new$ple_new_sib_y_bad, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

## 2-Way Cross Tabulation - arrest/jail/law/trouble holding job,fights,police items - MB_subsample1_new

CrossTable(MB_subsample1_new$ple_arrest_y_bad, 
           MB_subsample1_new$ple_law_y_bad,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_arrest_y_bad, 
           MB_subsample1_new$ple_jail_y_bad,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_arrest_y_bad, 
           MB_subsample1_new$famhx_ss_parent_trb_p_rec,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_law_y_bad, 
           MB_subsample1_new$ple_jail_y_bad,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_law_y_bad, 
           MB_subsample1_new$famhx_ss_parent_trb_p_rec,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$ple_jail_y_bad, 
           MB_subsample1_new$famhx_ss_parent_trb_p_rec,  
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)


## 2-Way Cross Tabulation - parent mental illness & substance abuse items (Family History) - MB_subsample1_new

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_dg_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_dprs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_ma_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_alc_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_dprs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_ma_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dg_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_ma_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_dprs_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_vs_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_ma_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_nrv_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_vs_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_nrv_p_rec, MB_subsample1_new$famhx_ss_parent_prf_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_nrv_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_nrv_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_prf_p_rec, MB_subsample1_new$famhx_ss_parent_hspd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_prf_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)

CrossTable(MB_subsample1_new$famhx_ss_parent_hspd_p_rec, MB_subsample1_new$famhx_ss_parent_scd_p_rec, 
           expected=TRUE, prop.r=TRUE, prop.c=TRUE, prop.t=TRUE, prop.chisq=TRUE, 
           chisq=TRUE, missing.include=FALSE,
           format=c("SAS","SPSS"), dnn = NULL)


# LIST OF ALL VARIABLES HERE. NOTE THAT THE MODELS BELOW ALREADY ~~REMOVED ALL PARENT REPORT LIFE EVENTS~~, BUT THEY ARE LISTED HERE:
#
# demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + 	famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_p_bad + ple_injured_p_bad + ple_crime_p_bad + 	ple_friend_p_bad + ple_friend_injur_p_bad + ple_financial_p_bad + ple_sud_p_bad + 	ple_ill_p_bad + ple_injur_p_bad + ple_argue_p_bad + ple_job_p_bad + ple_away_p_bad + 	ple_arrest_p_bad + ple_friend_died_p_bad + ple_mh_p_bad + ple_sib_p_bad + ple_victim_p_bad + ple_separ_p_bad + ple_law_p_bad + ple_school_p_bad + ple_move_p_bad + ple_jail_p_bad + 	ple_step_p_bad + ple_new_job_p_bad + ple_new_sib_p_bad + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + 	fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z

#george I'm sorry for my messy code and overcommenting. Pls don't judge me. MLB
```



```{r efa lavaan adversity factor}
# First we set up an EFA to see really how many factors there should be. We hope that one day we can fit all indicators onto one predefined adversity var in a CFA (later in code). But first we need to do these EFAs.
# See: https://vankesteren.github.io/efast/efa_lavaan 
# And: https://stats.stackexchange.com/questions/190190/can-lavaan-sem-cfa-be-used-to-do-factor-analysis-like-factanal-efa
# And: https://solomonkurz.netlify.app/post/2021-05-11-yes-you-can-fit-an-exploratory-factor-analysis-with-lavaan/
# OR possibly with the psych package first, just to do plain factor analysis (so don't constrain/pre-decide the number of factors?)

# UPDATE: None of the lavaan EFAs below work with WLSMV because of something to do with missing values. They work with MLR and non-ordered but are not identified.

# Here first is set up for EFA with just one factor
f1 <- '
efa("efa")*f1 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f1 <- 
  cfa(model = f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )
# NaNs producedError in eigen(A, symmetric = TRUE, only.values = TRUE) : 
#  infinite or missing values in 'x'
# 
# whyyyyyy

summary(efa_f1, fit.measures = TRUE)

# Repeat with 2 factor, 3 factor, 4 factor etc EFA models - look for NS chi-squared values and identify which model it is (and what are the obvious factors?)

f2 <- '
efa("efa")*f1 +
efa("efa")*f2 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f2 <- 
  cfa(model = f2,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      mimic = "Mplus",
      )
summary(efa_f2, fit.measures = TRUE)

f3 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f3 <- 
  cfa(model = f3,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f4 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f4 <- 
  cfa(model = f4,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f5 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f5 <- 
  cfa(model = f5,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f6 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f6 <- 
  cfa(model = f6,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f7 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f7 <- 
  cfa(model = f7,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f8 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 +
efa("efa")*f8 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f8 <- 
  cfa(model = f8,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f9 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 +
efa("efa")*f8 +
efa("efa")*f9 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f9 <- 
  cfa(model = f9,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )

f10 <- '
efa("efa")*f1 +
efa("efa")*f2 +
efa("efa")*f3 +
efa("efa")*f4 +
efa("efa")*f5 +
efa("efa")*f6 +
efa("efa")*f7 +
efa("efa")*f8 +
efa("efa")*f9 +
efa("efa")*f10 =~ 
demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec + 	famhx_ss_parent_alc_p_rec + famhx_ss_parent_dg_p_rec + famhx_ss_parent_dprs_p_rec + 	famhx_ss_parent_ma_p_rec + famhx_ss_parent_vs_p_rec + famhx_ss_parent_trb_p_rec + famhx_ss_parent_nrv_p_rec + famhx_ss_parent_prf_p_rec + famhx_ss_parent_hspd_p_rec + 	famhx_ss_parent_scd_p_rec + ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + 	ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + 	ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + 	ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + 	ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad + ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_766_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + 	demo_comb_income_v2_rec_rev_Z
'

efa_f10 <- 
  cfa(model = f10,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      missing = "pairwise",
      ordered = c("demo_fam_exp1_v2_rec","demo_fam_exp2_v2_rec","demo_fam_exp3_v2_rec","demo_fam_exp4_v2_rec",
                  "demo_fam_exp5_v2_rec","demo_fam_exp6_v2_rec","demo_fam_exp7_v2_rec","famhx_ss_parent_alc_p_rec",
                  "famhx_ss_parent_dg_p_rec","famhx_ss_parent_dprs_p_rec","famhx_ss_parent_ma_p_rec","famhx_ss_parent_vs_p_rec",
                  "famhx_ss_parent_trb_p_rec","famhx_ss_parent_nrv_p_rec","famhx_ss_parent_prf_p_rec","famhx_ss_parent_hspd_p_rec",
                  "famhx_ss_parent_scd_p_rec","ple_died_y_bad","ple_injured_y_bad","ple_crime_y_bad",
                  "ple_friend_y_bad","ple_friend_injur_y_bad","ple_financial_y_bad","ple_sud_y_bad","ple_ill_y_bad","ple_injur_y_bad",
                  "ple_argue_y_bad","ple_job_y_bad","ple_away_y_bad","ple_arrest_y_bad","ple_friend_died_y_bad","ple_mh_y_bad",
                  "ple_sib_y_bad","ple_victim_y_bad","ple_separ_y_bad","ple_law_y_bad","ple_school_y_bad","ple_move_y_bad",
                  "ple_jail_y_bad","ple_step_y_bad","ple_new_job_y_bad","ple_new_sib_y_bad","ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_766_p","ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )


```   


```{r psych fa}
#missing	
#if scores are TRUE, and missing=TRUE, then impute missing values using either the median or the mean. Haven't done this yet but could.

MB_S1_trim <- select(MB_subsample1, -c("X1","src_subject_id","eventname","subsample","ple_died_p_bad","ple_injured_p_bad","ple_crime_p_bad",
                                       "ple_friend_p_bad","ple_friend_injur_p_bad","ple_financial_p_bad","ple_sud_p_bad","ple_ill_p_bad",
                                       "ple_injur_p_bad","ple_argue_p_bad","ple_job_p_bad","ple_away_p_bad","ple_arrest_p_bad",
                                       "ple_friend_died_p_bad","ple_mh_p_bad","ple_sib_p_bad","ple_victim_p_bad","ple_separ_p_bad",
                                       "ple_law_p_bad","ple_school_p_bad","ple_move_p_bad","ple_jail_p_bad","ple_step_p_bad",
                                       "ple_new_job_p_bad","ple_new_sib_p_bad")) 

fa_1 <- fa(MB_S1_trim, nfactors=1, rotate = "oblimin")
fa_1
fa_2 <- fa(MB_S1_trim, nfactors=2, rotate = "oblimin")
fa_2
fa_3 <- fa(MB_S1_trim, nfactors=3, rotate = "oblimin")
fa_3
fa_4 <- fa(MB_S1_trim, nfactors=4, rotate = "oblimin")
fa_4
fa_5 <- fa(MB_S1_trim, nfactors=5, rotate = "oblimin")
fa_5
fa_6 <- fa(MB_S1_trim, nfactors=6, rotate = "oblimin")
fa_6
fa_7 <- fa(MB_S1_trim, nfactors=7, rotate = "oblimin")
fa_7
fa_8 <- fa(MB_S1_trim, nfactors=8, rotate = "oblimin")
fa_8
fa_9 <- fa(MB_S1_trim, nfactors=9, rotate = "oblimin")
fa_9
fa_10 <- fa(MB_S1_trim, nfactors=10, rotate = "oblimin")
fa_10
fa_20 <- fa(MB_S1_trim, nfactors=20, rotate = "oblimin")
fa_20
write.csv(fa_20$loadings, file = "loadings_fa20_no_parentSLEs.csv")
```



## We can't seem to get all these indicators loaded onto one super (adversity) factor, so in this next part we will try five separate factor analyses, one for each domain of ACES: "Abuse", "Household challenges", "Neglect", "Stressful events", and "Social environment"

```{r efa lavaan domain factors}

# ----- ABUSE -----
# Physical abuse: "ksads_ptsd_raw_761_p", "ksads_ptsd_raw_763_p", 
# Sexual abuse: "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p", "ksads_ptsd_raw_769_p"

abuse_f1 <- '
efa("efa")*abuse_f1 =~ 
ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p 
'
efa_abuse_f1 <- 
  cfa(model = abuse_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )
summary(efa_abuse_f1, fit.measures = TRUE, standardized = TRUE)

efa_abuse_f1_mlr <- 
  cfa(model = abuse_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      mimic = "Mplus",
      )
summary(efa_abuse_f1_mlr, fit.measures = TRUE)
# Both methods for f1 warning
#    The variance-covariance matrix of the estimated parameters (vcov)
#    does not appear to be positive definite! The smallest eigenvalue
#    (= -8.822038e-20) is smaller than zero. This may be a symptom that
#    the model is not identified.

# NS chi-sq 
# option 1. loadings high enough to combine first 4 and keep 5th (769)
# option 2. combine 2 phys abuse, 2 sexual abuse and 1 peer sexual abuse
    


# ----- NEGLECT -----
# Emotional neglect: "crpbi_y_ss_parent_rev_z", "crpbi_y_ss_caregiver_rev_z"
# Physical neglect: "pmq_y_ss_mean_rev_z"

neglect_f1 <- '
efa("efa")*neglect_f1 =~ 
crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z
'
efa_neglect_f1_mlr <- 
  cfa(model = neglect_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      missing = "ML",
      mimic = "Mplus",
      )
summary(efa_neglect_f1_mlr, fit.measures = TRUE, standardized = TRUE)
# 1 factor ran but chi-sq is significant. (bc only 3 indicators)




# ----- STRESSFUL EVENTS -----
# Stressors: '"ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_arrest_y_bad", "ple_friend_died_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_law_y_bad", "ple_school_y_bad", "ple_move_y_bad", "ple_jail_y_bad", "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad"

stress_f1 <- '
efa("efa")*stress_f1 =~ 
ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
'
efa_stress_f1 <- 
  cfa(model = stress_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_arrest_y_bad", "ple_friend_died_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_law_y_bad", "ple_school_y_bad", "ple_move_y_bad", "ple_jail_y_bad", "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad")
      )
summary(efa_stress_f1, fit.measures = TRUE, standardized = TRUE)
# Ran but chi sq NS


stress_f5 <- '
efa("efa")*stress_f1 +
efa("efa")*stress_f2 +
efa("efa")*stress_f3 +
efa("efa")*stress_f4 +
efa("efa")*stress_f5 =~ 
ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
'
efa_stress_f5 <- 
  cfa(model = stress_f5,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_arrest_y_bad", "ple_friend_died_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_law_y_bad", "ple_school_y_bad", "ple_move_y_bad", "ple_jail_y_bad", "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad")
      )
summary(efa_stress_f5, fit.measures = TRUE, standardized = TRUE)

# law items should be combined
# Friend died on its own or removed (since low frequency)
stress_law_f1 <- '
efa("efa")*stress_law_f1 =~
ple_arrest_y_bad + ple_law_y_bad + ple_jail_y_bad
'
efa_stress_law_f1 <-
  cfa(model = stress_law_f1,
      data = MB_subsample1,
      rotation ="oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_arrest_y_bad","ple_law_y_bad","ple_jail_y_bad"))
summary(efa_stress_law_f1, fit.measures = TRUE, standardized = TRUE)

# Remove law + friend died items:
stress_reduced_f3 <- '
efa("efa")*stress_reduced_f1 +
efa("efa")*stress_reduced_f2 +
efa("efa")*stress_reduced_f3 =~ 
ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_school_y_bad + ple_move_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
'
efa_stress_reduced_f3 <- 
  cfa(model = stress_reduced_f3,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_died_y_bad", "ple_injured_y_bad", "ple_crime_y_bad", "ple_friend_y_bad", "ple_friend_injur_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_ill_y_bad", "ple_injur_y_bad", "ple_argue_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_mh_y_bad", "ple_sib_y_bad", "ple_victim_y_bad", "ple_separ_y_bad", "ple_school_y_bad", "ple_move_y_bad",  "ple_step_y_bad", "ple_new_job_y_bad", "ple_new_sib_y_bad")
      )
summary(efa_stress_reduced_f3, fit.measures = TRUE, standardized = TRUE)

# Highest loadings, 3 factor stressor model without law or friend dying items:
#   1 - injury -- ple_injur_y_bad (0.603) "Child was seriously injured" - combine with "ple_injured_y_bad", "ple_crime_y_bad","ple_friend_injur_y_bad", "ple_ill_y_bad", "ple_mh_y_bad"
#   2 - changes to home environ (separation) -- ple_separ_y_bad (0.677) "Parents separated or divorced?" - combine with "ple_argue_y_bad", "ple_sib_y_bad", "ple_step_y_bad",
#   3 - moving / new job & school -- ple_move_y_bad (0.726) "Family moved?" - combine with "ple_school_y_bad","ple_new_job_y_bad"

# What should we do about the items that don't have very high loadings on any of these 3 factors?
#   "ple_died_y_bad", "ple_friend_y_bad", "ple_financial_y_bad", "ple_sud_y_bad", "ple_job_y_bad", "ple_away_y_bad", "ple_victim_y_bad", "ple_new_sib_y_bad"


# ----- SOCIAL ENVIRONMENT -----
# School environment: "srpf_y_ss_ses_rev_Z"
# Neighbourhood: "nsc_p_ss_mean_3_items_rev_Z", "neighborhood_crime_y_rev_Z"

social_f1 <- '
efa("efa")*social_f1 =~ 
srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z
'
efa_social_f1_mlr <- 
  cfa(model = social_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "MLR",
      missing = "ML",
      mimic = "Mplus",
      )
summary(efa_social_f1_mlr, fit.measures = TRUE, standardized = TRUE)
# Ran fine but chi-sq NS (bc only 3 indicators)

# 3 factors model combining Abuse, Neglect, and Social items:
AbNeSo_f3 <- '
efa("efa")*AbNeSo_f1 +
efa("efa")*AbNeSo_f2 +
efa("efa")*AbNeSo_f3 =~ 
ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z
'
efa_AbNeSo_f3 <- 
  cfa(model = AbNeSo_f3,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )
summary(efa_AbNeSo_f3, fit.measures = TRUE, standardized = TRUE)

# New stressor model best items from injury, home env, moving, law + friend died on its own
stress_new_f1 <- '
efa("efa")*new_f1 =~
ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_friend_died_y_bad + ple_law_y_bad
'
efa_stress_new_f1 <- 
  cfa(model = stress_new_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_friend_died_y_bad","ple_law_y_bad")
      )
summary(efa_stress_new_f1, fit.measures = TRUE, standardized = TRUE)
# ple_friend_died_y_bad low - remove (esp if low frequency (NOTE: YES ONLY 42!))

# Re estimate without friend died
stress_new2_f1 <- '
efa("efa")*new2_f1 =~
ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad
'
efa_stress_new2_f1 <- 
  cfa(model = stress_new2_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
summary(efa_stress_new2_f1, fit.measures = TRUE, standardized = TRUE)

# Estimate same model with abuse, neglect, social, new stress (4 factors) AbNeSoSt
AbNeSoSt_f4 <- '
efa("efa")*AbNeSoSt_f1 +
efa("efa")*AbNeSoSt_f2 +
efa("efa")*AbNeSoSt_f3 +
efa("efa")*AbNeSoSt_f4 =~ 
ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad
'
efa_AbNeSoSt_f4 <- 
  cfa(model = AbNeSoSt_f4,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_761_p","ksads_ptsd_raw_763_p",
                  "ksads_ptsd_raw_767_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p", "ple_injur_y_bad", "ple_separ_y_bad", "ple_move_y_bad", "ple_law_y_bad")
      )
summary(efa_AbNeSoSt_f4, fit.measures = TRUE, standardized = TRUE)

# Some variances negative, some loadings weirdly placed.
# Tried again but only one item per theoretical domain:

# Physical abuse: ksads_ptsd_raw_763_p 
# Sexual abuse: ksads_ptsd_raw_767_p
# Peer sexual abuse: ksads_ptsd_raw_769_p
# Neglect / lack of acceptance: crpbi_y_ss_parent_rev_z
# Neighborhood safety: neighborhood_crime_y_rev_Z
# Family injured: ple_injur_y_bad
# Family structure change: ple_separ_y_bad
# Moving: ple_move_y_bad
# Family law trouble: ple_law_y_bad

AbNeSoSt_reduced_f1 <- '
efa("efa")*AbNeSoSt_reduced_f1 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad
'
efa_AbNeSoSt_reduced_f1 <- 
  cfa(model = AbNeSoSt_reduced_f1,
      data = MB_subsample1,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_769_p", "crpbi_y_ss_parent_rev_z", "neighborhood_crime_y_rev_Z", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
summary(efa_AbNeSoSt_reduced_f1, fit.measures = TRUE, standardized = TRUE)
# Chi sq sig - Move item is now loading at 0.199 - should we remove or make 2 factors?


# ----- HOUSEHOLD CHALLENGES -----
# Home violence exposure: "ksads_ptsd_raw_766_p"
# Household substance abuse: "famhx_ss_parent_alc_p_rec", "famhx_ss_parent_dg_p_rec""
# Parent Mental illness in household: "famhx_ss_parent_dprs_p_rec", "famhx_ss_parent_ma_p_rec", "famhx_ss_parent_vs_p_rec", "famhx_ss_parent_trb_p_rec", "famhx_ss_parent_nrv_p_rec", "famhx_ss_parent_prf_p_rec", "famhx_ss_parent_hspd_p_rec", "famhx_ss_parent_scd_p_rec", "asr_scr_totprob_t_z"
# Family conflict: "fes_p_ss_fc_z", "fes_y_ss_fc_z"
# Family income: "demo_comb_income_v2_rec_rev_Z"
# Economic hardship: "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec"

MB_subsample1_ren <- rename(MB_subsample1, famhx_alc = famhx_ss_parent_alc_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_dg = famhx_ss_parent_dg_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_dprs = famhx_ss_parent_dprs_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_ma = famhx_ss_parent_ma_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_vs = famhx_ss_parent_vs_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_trb = famhx_ss_parent_trb_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_nrv = famhx_ss_parent_nrv_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_prf = famhx_ss_parent_prf_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_hspd = famhx_ss_parent_hspd_p_rec)
MB_subsample1_ren <- rename(MB_subsample1_ren, famhx_scd = famhx_ss_parent_scd_p_rec)

household_f1 <- '
efa("efa")*household_f1 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_household_f1 <- 
  cfa(model = household_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd", "demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )

summary(efa_household_f1, fit.measures = TRUE, standardized = TRUE)
# Chi sq is sig but loadings are all pretty decent.

household_f5 <- '
efa("efa")*household_f1 +
efa("efa")*household_f2 + 
efa("efa")*household_f3 +
efa("efa")*household_f4 +
efa("efa")*household_f5 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_household_f5 <- 
  cfa(model = household_f5,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd", "demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_household_f5, fit.measures = TRUE, standardized = TRUE)
# 5 factor runs ok but chi-sq is sig. Try 6 factor.

household_f6 <- '
efa("efa")*household_f1 +
efa("efa")*household_f2 + 
efa("efa")*household_f3 +
efa("efa")*household_f4 +
efa("efa")*household_f5 +
efa("efa")*household_f6 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_household_f6 <- 
  cfa(model = household_f6,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd", "demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_household_f6, fit.measures = TRUE, standardized = TRUE)
# 6 factor some variance are neg but chi-sq is NS

# Trying economic hardship ones on their own:
economic_f1 <- '
efa("efa")*economic_f1 =~
demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_economic_f1 <-
  cfa(model = economic_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
econf1 <- modindices(efa_economic_f1, sort = TRUE, maximum.number = 10)
summary(efa_economic_f1, fit.measures = TRUE, standardized = TRUE)
# Chi sq significant but loadings all high. 
# item 2 (telephone cut off) is highest loading but income one might be the best because it's continuous

# Try 2 factor in case medical econ hardship is separate:
economic_f2 <- '
efa("efa")*economic_f1 +
efa("efa")*economic_f2 =~
demo_comb_income_v2_rec_rev_Z + demo_fam_exp1_v2_rec + demo_fam_exp2_v2_rec + demo_fam_exp3_v2_rec + demo_fam_exp4_v2_rec + demo_fam_exp5_v2_rec + demo_fam_exp6_v2_rec + demo_fam_exp7_v2_rec
'
efa_economic_f2 <-
  cfa(model = economic_f2,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("demo_fam_exp1_v2_rec", "demo_fam_exp2_v2_rec", "demo_fam_exp3_v2_rec", "demo_fam_exp4_v2_rec", "demo_fam_exp5_v2_rec", "demo_fam_exp6_v2_rec", "demo_fam_exp7_v2_rec")
      )
summary(efa_economic_f2, fit.measures = TRUE, standardized = TRUE)
# Could not compute standard errors! The information matrix could
#    not be inverted. This may be a symptom that the model is not
#   identified.
# Item 7 seems to be causing problems
# Anyway, highest economic hardship loading on the 1 factor (sig chi sq) is xp2, telephone cut off (0.884) but all in in .7 - .8

# Now trying other household challenge items without economic hardship...
household_reduced_f1 <- '
efa("efa")*household_reduced_f1 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z 
'
efa_household_reduced_f1 <- 
  cfa(model = household_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd")
      )
summary(efa_household_reduced_f1, fit.measures = TRUE, standardized = TRUE)
# chi-sq sig

household_reduced_f4 <- '
efa("efa")*household_reduced_f1 +
efa("efa")*household_reduced_f2 +
efa("efa")*household_reduced_f3 +
efa("efa")*household_reduced_f4 =~ 
ksads_ptsd_raw_766_p + famhx_alc + famhx_dg + famhx_dprs + famhx_ma + famhx_vs + famhx_trb + famhx_nrv + famhx_prf + famhx_hspd + famhx_scd + asr_scr_totprob_t_z + fes_p_ss_fc_z + fes_y_ss_fc_z 
'
efa_household_reduced_f4 <- 
  cfa(model = household_reduced_f4,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_766_p", "famhx_alc", "famhx_dg", "famhx_dprs", "famhx_ma", "famhx_vs", "famhx_trb", "famhx_nrv", "famhx_prf", "famhx_hspd", "famhx_scd")
      )
summary(efa_household_reduced_f4, fit.measures = TRUE, standardized = TRUE)
# chi sq-NS

# Highest loadings, 4 factor household model without econ hardhip items:
#   1 --- dprs (0.847) "" - combine with "ptsd766", "alc","ma","vs","trb"
#   2 --- prf (0.937) "" - combine with "dg","nrv","hspd","scd",
#   3 --- "asr" (0.714) "" - combine with "fes_p"
#   4 --- "fes_y" (.665) on its own

#Try those 4 alone:
household_new_reduced_f1 <- '
efa("efa")*household_new_reduced_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z + fes_y_ss_fc_z  
'
efa_household_new_reduced_f1 <- 
  cfa(model = household_new_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf")
      )
summary(efa_household_new_reduced_f1, fit.measures = TRUE, standardized = TRUE)
# chi-sq sig

# Try those 4 PLUS the income one from econ hardship:
household_new_f1 <- '
efa("efa")*household_new_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z 
'
efa_household_new_f1 <- 
  cfa(model = household_new_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf")
      )
house_new_mods <- modindices(efa_household_new_f1, sort = TRUE, maximum.number = 5)
summary(efa_household_new_f1, fit.measures = TRUE, standardized = TRUE)
#chi-sq sig

#fes_y is causing problems. Try it removed
household_new2_f1 <- '
efa("efa")*household_new2_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z + demo_fam_exp2_v2_rec 
'
efa_household_new2_f1 <- 
  cfa(model = household_new2_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf", "demo_fam_exp2_v2_rec")
      )
summary(efa_household_new2_f1, fit.measures = TRUE, standardized = TRUE)
# chi-sq still sig. Remove econ hardship again
household_new2_reduced_f1 <- '
efa("efa")*household_new2_reduced_f1 =~ 
famhx_dprs + famhx_prf + asr_scr_totprob_t_z  
'
efa_household_new2_reduced_f1 <- 
  cfa(model = household_new2_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("famhx_dprs", "famhx_prf")
      )
summary(efa_household_new2_reduced_f1, fit.measures = TRUE, standardized = TRUE)

# only use total symptoms for parent
household_new3_f1 <- '
efa("efa")*household_new3_f1 =~ 
asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z 
'
efa_household_new3_f1 <- 
  cfa(model = household_new3_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "ML",
      mimic = "Mplus"
      )
house_new3_mods <- modindices(efa_household_new3_f1, sort = TRUE, maximum.number = 5)
summary(efa_household_new3_f1, fit.measures = TRUE, standardized = TRUE)
#chi sq still sig but ok bc only 3 items
# highest loading famhx_prf (0.748)

# ----Try a full model

# Physical abuse: ksads_ptsd_raw_763_p 
# Sexual abuse: ksads_ptsd_raw_767_p
# Peer sexual abuse: ksads_ptsd_raw_769_p
# Neglect / lack of acceptance: crpbi_y_ss_parent_rev_z
# Neighborhood safety: neighborhood_crime_y_rev_Z
# Family injured: ple_injur_y_bad
# Family structure change: ple_separ_y_bad
# Moving: ple_move_y_bad
# Family law trouble: ple_law_y_bad
# Economic hardship: demo_fam_exp2_v2_rec
# Household challenges (parent mental health): demo_comb_income_v2_rec_rev_Z

# only one abuse item:
AbNeSoStHo_reduced_f1 <- '
efa("efa")*AbNeSoStHo_reduced_f1 =~
ksads_ptsd_raw_763_p + crpbi_y_ss_parent_rev_z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad + demo_comb_income_v2_rec_rev_Z + asr_scr_totprob_t_z
'
efa_AbNeSoStHo_reduced_f1 <- 
  cfa(model = AbNeSoStHo_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p",  "crpbi_y_ss_parent_rev_z", "neighborhood_crime_y_rev_Z", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
stuff <- modindices(efa_AbNeSoStHo_reduced_f1, sort = TRUE, maximum.number = 5)
summary(efa_AbNeSoStHo_reduced_f1, fit.measures = TRUE, standardized = TRUE)

# try with at least 3 per domain
# Abuse: ksads 763, 767, 768
# Neglect: crpbi y, crpbi p, pmq
# social: srpf, nsc, neighborhood crime
# stressors: injur, separ, move, law
# household: asr, fes, income

AbNeSoStHo_reduced_f1 <- '
efa("efa")*AbNeSoStHo_reduced_f1 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reduced_f1 <- 
  cfa(model = AbNeSoStHo_reduced_f1,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
full_mi1 <- modindices(efa_AbNeSoStHo_reduced_f1, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reduced_f1, fit.measures = TRUE, standardized = TRUE)

AbNeSoStHo_reduced_f2 <- '
efa("efa")*AbNeSoStHo_reduced_f1 +
efa("efa")*AbNeSoStHo_reduced_f2 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reduced_f2 <- 
  cfa(model = AbNeSoStHo_reduced_f2,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
full_mi2 <- modindices(efa_AbNeSoStHo_reduced_f2, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reduced_f2, fit.measures = TRUE, standardized = TRUE)

AbNeSoStHo_reduced_f3 <- '
efa("efa")*AbNeSoStHo_reduced_f1 +
efa("efa")*AbNeSoStHo_reduced_f2 +
efa("efa")*AbNeSoStHo_reduced_f3 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reduced_f3 <- 
  cfa(model = AbNeSoStHo_reduced_f3,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
full_mi3 <- modindices(efa_AbNeSoStHo_reduced_f3, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reduced_f3, fit.measures = TRUE, standardized = TRUE)
# Some variances neg
# X2(75)=96.475, p = 0.048

AbNeSoStHo_reduced_f4 <- '
efa("efa")*AbNeSoStHo_reduced_f1 +
efa("efa")*AbNeSoStHo_reduced_f2 +
efa("efa")*AbNeSoStHo_reduced_f3 +
efa("efa")*AbNeSoStHo_reduced_f4 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + ple_injur_y_bad + ple_separ_y_bad + ple_move_y_bad + ple_law_y_bad + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reduced_f4 <- 
  cfa(model = AbNeSoStHo_reduced_f4,
      data = MB_subsample1_ren,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p", "ple_injur_y_bad","ple_separ_y_bad","ple_move_y_bad","ple_law_y_bad")
      )
full_mi4 <- modindices(efa_AbNeSoStHo_reduced_f4, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reduced_f4, fit.measures = TRUE, standardized = TRUE)
# Some variances neg
# X2(62)=72.133, p = 0.178


# Try it with new stressor variable since the binary ones aren't loading onto anything
MB_subsample1_new <- MB_subsample1
attach(MB_subsample1_new)
MB_subsample1_new$PLE_total <- ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
detach(MB_subsample1_new)

AbNeSoStHo_reducedPLE_f3 <- '
efa("efa")*AbNeSoStHo_reducedPLE_f1 +
efa("efa")*AbNeSoStHo_reducedPLE_f2 +
efa("efa")*AbNeSoStHo_reducedPLE_f3 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + PLE_total + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reducedPLE_f3 <- 
  cfa(model = AbNeSoStHo_reducedPLE_f3,
      data = MB_subsample1_new,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_767_p", "ksads_ptsd_raw_768_p")
      )
full_mi3_PLE <- modindices(efa_AbNeSoStHo_reducedPLE_f3, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reducedPLE_f3, fit.measures = TRUE, standardized = TRUE)
# still neg variance, seems to be ksads 767 is the problem, maybe ok to remove since 768 also asks about sexual abuse

AbNeSoStHo_reducedPLE2_f3 <- '
efa("efa")*AbNeSoStHo_reducedPLE_f1 +
efa("efa")*AbNeSoStHo_reducedPLE_f2 +
efa("efa")*AbNeSoStHo_reducedPLE_f3 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_768_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + PLE_total + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reducedPLE2_f3 <- 
  cfa(model = AbNeSoStHo_reducedPLE2_f3,
      data = MB_subsample1_new,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_768_p")
      )
full_mi3_PLE2 <- modindices(efa_AbNeSoStHo_reducedPLE2_f3, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reducedPLE2_f3, fit.measures = TRUE, standardized = TRUE)
#now ksads 763 var is negative. Maybe only 1 abuse item needed?

AbNeSoStHo_reducedPLE3_f3 <- '
efa("efa")*AbNeSoStHo_reducedPLE_f1 +
efa("efa")*AbNeSoStHo_reducedPLE_f2 +
efa("efa")*AbNeSoStHo_reducedPLE_f3 =~
ksads_ptsd_raw_768_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + PLE_total + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reducedPLE3_f3 <- 
  cfa(model = AbNeSoStHo_reducedPLE3_f3,
      data = MB_subsample1_new,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p", "ksads_ptsd_raw_768_p")
      )
full_mi3_PLE3 <- modindices(efa_AbNeSoStHo_reducedPLE3_f3, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reducedPLE3_f3, fit.measures = TRUE, standardized = TRUE)
# This give us (barely) NS model, with three factors
# 1: Abuse and ASR
# 2: CRPBI Y, CRPBI P, PMQ, SRPF, FES
# 3: NSC, Neighborhood, PLE total, income

# Having only one abuse item is annoying but not sure what to do, maybe add up total abuse like the stressors:
attach(MB_subsample1_new)
MB_subsample1_new$abuse_total <- ksads_ptsd_raw_761_p + ksads_ptsd_raw_763_p + ksads_ptsd_raw_767_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p
detach(MB_subsample1_new)

AbNeSoStHo_reducedfinal_f3 <- '
efa("efa")*AbNeSoStHo_reducedPLE_f1 +
efa("efa")*AbNeSoStHo_reducedPLE_f2 +
efa("efa")*AbNeSoStHo_reducedPLE_f3 =~
abuse_total + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + PLE_total + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reducedfinal_f3 <- 
  cfa(model = AbNeSoStHo_reducedfinal_f3,
      data = MB_subsample1_new,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus"
      )
full_mi3_reducedfinal <- modindices(efa_AbNeSoStHo_reducedfinal_f3, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reducedfinal_f3, fit.measures = TRUE, standardized = TRUE)
# nah - abuse_total isn't on anything now

# go back to three total abuse items but one (highest loading) from each subdomain - one phys abuse (763), one sexual abuse (768), one peer sexual abuse (769) - instead of just the three highest loadings on abuse, which doesn't make theoretical sense.
AbNeSoStHo_reducedfinal2_f3 <- '
efa("efa")*AbNeSoStHo_reducedPLE_f1 +
efa("efa")*AbNeSoStHo_reducedPLE_f2 +
efa("efa")*AbNeSoStHo_reducedPLE_f3 =~
ksads_ptsd_raw_763_p + ksads_ptsd_raw_768_p + ksads_ptsd_raw_769_p + crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + nsc_p_ss_mean_3_items_rev_Z + neighborhood_crime_y_rev_Z + PLE_total + asr_scr_totprob_t_z + fes_y_ss_fc_z + demo_comb_income_v2_rec_rev_Z
'
efa_AbNeSoStHo_reducedfinal2_f3 <- 
  cfa(model = AbNeSoStHo_reducedfinal2_f3,
      data = MB_subsample1_new,
      rotation = "oblimin",
      estimator = "WLSMV",
      mimic = "Mplus",
      ordered = c("ksads_ptsd_raw_763_p","ksads_ptsd_raw_768_p","ksads_ptsd_raw_769_p")
      )
full_mi3_reducedfinal2 <- modindices(efa_AbNeSoStHo_reducedfinal2_f3, sort = TRUE, maximum.number = 10)
summary(efa_AbNeSoStHo_reducedfinal2_f3, fit.measures = TRUE, standardized = TRUE)
# THIS IS THE ONE!

# CFA subsample 1 - remove neighborhood crime bc just youth report and only one item nsc is probably fine
ss1_f3_nocov <- "
#3 factors model for subsample 1

abuse =~ ksads_ptsd_raw_763_p + ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p + asr_scr_totprob_t_z
connectedness =~ crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + fes_y_ss_fc_z 
hardship =~ nsc_p_ss_mean_3_items_rev_Z  + PLE_total + demo_comb_income_v2_rec_rev_Z
"

fit_ss1_f3_nocov <- cfa(model = ss1_f3_nocov, 
                  data = MB_subsample1_new,
                  estimator = "WLSMV",
                  missing = "pairwise",
                  mimic = "Mplus",
                  ordered = c("ksads_ptsd_raw_763_p","ksads_ptsd_raw_768_p",
                              "ksads_ptsd_raw_769_p")
                  )
summary(fit_ss1_f3_nocov, fit.measures = TRUE, standardized = TRUE)
ss1f3_mi <- modindices(fit_ss1_f3_nocov, sort = TRUE, maximum.number = 10)

```

## --------------------------------------------
## -------- SUBSAMPLE #2 - 3 FACTOR CFA -------
## --------------------------------------------

```{r subsample2}
# first make new stressfule life events count variable like we did in subsample 1
MB_subsample2_new <- MB_subsample2
attach(MB_subsample2_new)
MB_subsample2_new$PLE_total <- ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
detach(MB_subsample2_new)

# Define model for Subsample 2, based on the 3-factor model from the EFA building with Subsample 1:

# Factor 1 (Physical/sexual abuse)
# Factor 2 (Family & school connectedness)
# Factor 3 (Stressors & hardship)

ss2_f3_nocov <- "
#3 factors model for subsample 2

abuse =~ ksads_ptsd_raw_763_p + ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p + asr_scr_totprob_t_z
connectedness =~ crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + fes_y_ss_fc_z
hardship =~ nsc_p_ss_mean_3_items_rev_Z + PLE_total + demo_comb_income_v2_rec_rev_Z

"

fit_ss2_f3_nocov <- cfa(model = ss2_f3_nocov, 
                  data = MB_subsample2_new,
                  estimator = "WLSMV",
                  missing = "pairwise",
                  mimic = "Mplus",
                  ordered = c("ksads_ptsd_raw_763_p","ksads_ptsd_raw_768_p",
                              "ksads_ptsd_raw_769_p")
                  )
summary(fit_ss2_f3_nocov, fit.measures = TRUE, standardized = TRUE)
ss2f3_mi <- modindices(fit_ss2_f3_nocov, sort = TRUE, maximum.number = 10)

# Try with covariances for the same questionnaire
ss2_f3_cov <- "
#3 factors model for subsample 2

abuse =~ ksads_ptsd_raw_763_p + ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p + asr_scr_totprob_t_z
connectedness =~ crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + fes_y_ss_fc_z
hardship =~ nsc_p_ss_mean_3_items_rev_Z + PLE_total + demo_comb_income_v2_rec_rev_Z

#Covariances for questionnaires/measures
ksads_ptsd_raw_763_p ~~ ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p
ksads_ptsd_raw_768_p ~~ ksads_ptsd_raw_769_p
crpbi_y_ss_parent_rev_z ~~ crpbi_y_ss_caregiver_rev_z
"

fit_ss2_f3_cov <- cfa(model = ss2_f3_cov, 
                  data = MB_subsample2_new,
                  estimator = "WLSMV",
                  missing = "pairwise",
                  mimic = "Mplus",
                  ordered = c("ksads_ptsd_raw_763_p","ksads_ptsd_raw_768_p",
                              "ksads_ptsd_raw_769_p")
                  )
summary(fit_ss2_f3_cov, fit.measures = TRUE, standardized = TRUE)
ss2f3_mi_cov <- modindices(fit_ss2_f3_cov, sort = TRUE, maximum.number = 10)

# Extract factor scores and correlate with an averaged score of all observed variables on that factor. Correlation should be in the correct direction

fit_ss2f3cov_extract_vars <- lavPredict(fit_ss2_f3_cov, method = "EBM", type = "lv")
ss2f3cov_lve <- as.data.frame(fit_ss2f3cov_extract_vars)
ss2f3cov_lve <- select(ss2f3cov_lve, "abuse","connectedness","hardship")
cor(ss2f3cov_lve$abuse ~ MB_subsample2_new$asr_scr_totprob_t_z)# this should be positively correlated
# the factor scores should be normally distributed
hist(ss2f3cov_lve$abuse)
hist(ss2f3cov_lve$connectedness)
hist(ss2f3cov_lve$hardship)
```

## --------------------------------------------
## -------- SUBSAMPLE #3 - 3 FACTOR CFA -------
## --------------------------------------------


```{r subsample3}

# first make new stressfule life events count variable like we did in subsample 1
MB_subsample3_new <- MB_subsample3
attach(MB_subsample3_new)
MB_subsample3_new$PLE_total <- ple_died_y_bad + ple_injured_y_bad + ple_crime_y_bad + ple_friend_y_bad + ple_friend_injur_y_bad + ple_financial_y_bad + ple_sud_y_bad + ple_ill_y_bad + ple_injur_y_bad + ple_argue_y_bad + ple_job_y_bad + ple_away_y_bad + ple_arrest_y_bad + ple_friend_died_y_bad + ple_mh_y_bad + ple_sib_y_bad + ple_victim_y_bad + ple_separ_y_bad + ple_law_y_bad + ple_school_y_bad + ple_move_y_bad + ple_jail_y_bad + ple_step_y_bad + ple_new_job_y_bad + ple_new_sib_y_bad
detach(MB_subsample3_new)

# Define model for Subsample 3, TBC, just holding a place here to replace final decisions with later:

# Factor 1 (Physical/sexual abuse)
# Factor 2 (Family & school connectedness)
# Factor 3 (Stressors & hardship)

#Based on subsample 3, do NOT use covariances because the second one with covariances was maybe not identified
ss3_f3_nocov <- "
#3 factors model for subsample 2

abuse =~ ksads_ptsd_raw_763_p + ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p + asr_scr_totprob_t_z
connectedness =~ crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + fes_y_ss_fc_z
hardship =~ nsc_p_ss_mean_3_items_rev_Z + PLE_total + demo_comb_income_v2_rec_rev_Z
"

fit_ss3_f3_nocov <- cfa(model = ss3_f3_nocov, 
                  data = MB_subsample3_new,
                  estimator = "WLSMV",
                  missing = "pairwise",
                  mimic = "Mplus",
                  ordered = c("ksads_ptsd_raw_763_p","ksads_ptsd_raw_768_p",
                              "ksads_ptsd_raw_769_p")
                  )
summary(fit_ss3_f3_nocov, fit.measures = TRUE, standardized = TRUE)
ss3f3_mi <- modindices(fit_ss3_f3_nocov, sort = TRUE, maximum.number = 10)


# Extract factor scores and correlate with an averaged score of all observed variables on that factor. Correlation should be in the correct direction

fit_ss3f3nocov_extract_vars <- lavPredict(fit_ss3_f3_nocov, method = "EBM", type = "lv")
ss3f3nocov_lve <- as.data.frame(fit_ss3f3nocov_extract_vars)
ss3f3nocov_lve <- select(ss3f3nocov_lve, "abuse","connectedness","hardship")

ss3f3nocov_lve$asr_check <- MB_subsample3_new$asr_scr_totprob_t_z # we'll compare the lve's to a score in the latent var
summary(lm(ss3f3nocov_lve$abuse ~ ss3f3nocov_lve$asr_check))# this should be positively correlated (yes)
ss3f3nocov_lve$crpbi_par_check <- MB_subsample3_new$crpbi_y_ss_parent_rev_z
summary(lm(ss3f3nocov_lve$connectedness ~ ss3f3nocov_lve$crpbi_par_check))
ss3f3nocov_lve$nsc_check <- MB_subsample3_new$nsc_p_ss_mean_3_items_rev_Z
summary(lm(ss3f3nocov_lve$hardship ~ ss3f3nocov_lve$nsc_check))

# the factor scores should be normally distributed
hist(ss3f3nocov_lve$abuse)
hist(ss3f3nocov_lve$connectedness)
hist(ss3f3nocov_lve$hardship)

# Try with covariances for the same questionnaire - NO - see above
ss3_f3_cov <- "
#3 factors model for subsample 3

abuse =~ ksads_ptsd_raw_763_p + ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p + asr_scr_totprob_t_z
connectedness =~ crpbi_y_ss_parent_rev_z + crpbi_y_ss_caregiver_rev_z + pmq_y_ss_mean_rev_z + srpf_y_ss_ses_rev_Z + fes_y_ss_fc_z
hardship =~ nsc_p_ss_mean_3_items_rev_Z + PLE_total + demo_comb_income_v2_rec_rev_Z

#Covariances for questionnaires/measures
ksads_ptsd_raw_763_p ~~ ksads_ptsd_raw_768_p +  ksads_ptsd_raw_769_p
ksads_ptsd_raw_768_p ~~ ksads_ptsd_raw_769_p
crpbi_y_ss_parent_rev_z ~~ crpbi_y_ss_caregiver_rev_z
"

fit_ss3_f3_cov <- cfa(model = ss3_f3_cov, 
                  data = MB_subsample3_new,
                  estimator = "WLSMV",
                  missing = "pairwise",
                  mimic = "Mplus",
                  ordered = c("ksads_ptsd_raw_763_p","ksads_ptsd_raw_768_p",
                              "ksads_ptsd_raw_769_p")
                  )
summary(fit_ss3_f3_cov, fit.measures = TRUE, standardized = TRUE)
ss3f3_mi_cov <- modindices(fit_ss3_f3_cov, sort = TRUE, maximum.number = 10)

```